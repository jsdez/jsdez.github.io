/*! For license information please see neo-pricework.js.LICENSE.txt */
(()=>{"use strict";var t={2:(t,e,n)=>{n.d(e,{A:()=>a});var r=n(713),o=n.n(r),i=n(802),s=n.n(i)()(o());s.push([t.id,"/* Neo Pricework Component Styles */\n:host { \n  display: block; \n  font-family: var(--ntx-form-theme-font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif); \n  font-size: var(--ntx-form-theme-text-input-size, 14px); \n  line-height: 1.5; \n  color: var(--ntx-form-theme-color-input-text, #161718); \n}\n\n/* Card Components */\n.card { \n  background: var(--ntx-form-theme-color-form-background, #fff); \n  border: 1px solid var(--ntx-form-theme-color-border, #898f94); \n  border-radius: var(--ntx-form-theme-border-radius, 4px); \n  padding: .75rem 1rem; \n  margin-bottom: .5rem; \n}\n\n.card-title { \n  font-size: 18px; \n  font-weight: 700; \n  color: var(--ntx-form-theme-color-input-text, #161718); \n  margin: 0; \n}\n\n.list-header { \n  display: flex; \n  align-items: center; \n  justify-content: space-between; \n  margin-bottom: .75rem; \n}\n\n/* Badges */\n.badge { \n  display: inline-block; \n  padding: .25rem .5rem; \n  border-radius: 999px; \n  background: var(--ntx-form-theme-color-secondary-button-background, #fff); \n  color: var(--ntx-form-theme-color-secondary, #575c61); \n  border: 1px solid var(--ntx-form-theme-color-border, #898f94); \n  font-size: 12px; \n}\n\n/* Button Styles */\n.btn { \n  cursor: pointer; \n  display: inline-flex; \n  align-items: center; \n  gap: .35rem; \n  font-weight: 600; \n  border-radius: var(--ntx-form-theme-border-radius, 4px); \n  border: 1px solid transparent; \n  padding: .45rem .75rem; \n  line-height: 1.25; \n}\n\n.btn:disabled { \n  opacity: .65; \n  cursor: not-allowed; \n}\n\n.btn-primary { \n  background: var(--ntx-form-theme-color-primary-button-background, #006bd6); \n  color: var(--ntx-form-theme-color-primary-button-font, #fff); \n}\n\n.btn-primary:hover { \n  background: var(--ntx-form-theme-color-primary-button-hover, #2d83dc); \n}\n\n.btn-outline { \n  background: transparent; \n  color: var(--ntx-form-theme-color-primary, #006bd6); \n  border-color: var(--ntx-form-theme-color-primary, #006bd6); \n}\n\n.btn-outline:hover { \n  background: color-mix(in srgb, var(--ntx-form-theme-color-primary, #006bd6), #fff 85%); \n}\n\n.btn-danger { \n  background: var(--ntx-form-theme-color-error, #e60000); \n  color: #fff; \n}\n\n.btn-light { \n  background: var(--ntx-form-theme-color-form-background, #fff); \n  border: 1px solid var(--ntx-form-theme-color-border, #898f94); \n  color: var(--ntx-form-theme-color-input-text, #161718); \n}\n\n.btn-compact { \n  padding: .4rem .6rem; \n  line-height: 1.1; \n}\n\n/* Icon Buttons */\n.icon-btn { \n  display: inline-flex; \n  align-items: center; \n  justify-content: center; \n  width: 34px; \n  height: 34px; \n  padding: 0; \n  border: 1px solid var(--ntx-form-theme-color-border, #898f94); \n  border-radius: var(--ntx-form-theme-border-radius, 4px); \n  background: var(--ntx-form-theme-color-form-background, #fff); \n  color: var(--ntx-form-theme-color-error, #e60000); \n}\n\n.icon-btn:hover { \n  background: color-mix(in srgb, var(--ntx-form-theme-color-error, #e60000), #fff 90%); \n}\n\n.icon-btn.success { \n  background: var(--ntx-form-theme-color-success, #2e7d32); \n  color: #fff; \n  border-color: var(--ntx-form-theme-color-success, #2e7d32); \n}\n\n.icon-btn.success:hover { \n  background: color-mix(in srgb, var(--ntx-form-theme-color-success, #2e7d32), #000 10%); \n}\n\n/* Layout Components */\n.rows { \n  display: flex; \n  flex-direction: column; \n  gap: .5rem; \n}\n\n.row { \n  display: grid; \n  grid-template-columns: 1fr auto; \n  gap: .5rem .75rem; \n  align-items: center; \n}\n\n.title { \n  font-weight: 600; \n}\n\n.actions { \n  display: flex; \n  gap: .5rem; \n}\n\n.actions-inline { \n  display: flex; \n  align-items: center; \n  gap: .5rem; \n}\n\n/* Pills and Tags */\n.pill-group { \n  display: flex; \n  flex-wrap: wrap; \n  gap: .35rem; \n  margin-top: .25rem; \n}\n\n.pill { \n  border-radius: 999px; \n  padding: .15rem .5rem; \n  background: var(--ntx-form-theme-color-primary-light90, #e8f1f9); \n  color: var(--ntx-form-theme-color-primary, #006bd6); \n  font-weight: 600; \n}\n\n/* Notes */\n.notes { \n  margin-top: .5rem; \n  padding: .5rem .75rem; \n  background: var(--ntx-form-theme-color-form-background-alternate-contrast, #0000000d); \n  border-left: 3px solid var(--ntx-form-theme-color-primary, #006bd6); \n  border-radius: var(--ntx-form-theme-border-radius, 4px); \n}\n\n/* Field Lines and Labels in List Rows */\n.field-line { \n  display: flex; \n  align-items: center; \n  flex-wrap: wrap; \n  gap: .5rem; \n}\n\n.inline-label { \n  font-weight: 600; \n  color: var(--ntx-form-theme-color-input-text, #161718); \n}\n\n.right { \n  text-align: right; \n}\n\n.right .summary { \n  text-align: right; \n  color: var(--ntx-form-theme-color-input-text, #161718); \n  font-weight: 600; \n}\n\n.right-actions { \n  display: flex; \n  flex-direction: column; \n  gap: .4rem; \n  align-items: flex-end; \n}\n\n.right-actions .btn { \n  min-width: 120px; \n  display: flex; \n  justify-content: space-between; \n  align-items: center; \n}\n\n/* Utility Classes */\n.muted { \n  color: var(--ntx-form-theme-color-input-text-placeholder, #6c757d); \n}\n\n.footer { \n  margin-top: .75rem; \n  display: flex; \n  justify-content: space-between; \n  align-items: center; \n}\n\n.total { \n  font-weight: 700; \n}\n\n.empty { \n  color: var(--ntx-form-theme-color-input-text-placeholder, #6c757d); \n  text-align: center; \n  padding: .75rem; \n  border: 1px dashed var(--ntx-form-theme-color-border, #898f94); \n  border-radius: var(--ntx-form-theme-border-radius, 4px); \n  background: var(--ntx-form-theme-color-form-background-alternate-contrast, #0000000d); \n}\n\n/* Modal Styles */\n.backdrop { \n  position: fixed; \n  inset: 0; \n  background: rgba(0, 0, 0, .45); \n  display: flex; \n  align-items: center; \n  justify-content: center; \n  padding: 10px; \n  z-index: 10000; \n}\n\n.modal { \n  width: min(720px, calc(100vw - 20px)); \n  max-width: 100%; \n  max-height: 90vh; \n  display: flex; \n  flex-direction: column; \n  background: var(--ntx-form-theme-color-form-background, #fff); \n  border: 1px solid var(--ntx-form-theme-color-border, #898f94); \n  border-radius: var(--ntx-form-theme-border-radius, 4px); \n  box-shadow: 0 10px 30px rgba(0, 0, 0, .25); \n  box-sizing: border-box; \n}\n\n.modal-header, \n.modal-footer { \n  flex: 0 0 auto; \n  padding: .75rem 1rem; \n  border-bottom: 1px solid var(--ntx-form-theme-color-border, #898f94); \n  display: flex; \n  align-items: center; \n  justify-content: space-between; \n}\n\n.modal-footer { \n  border-bottom: 0; \n  border-top: 1px solid var(--ntx-form-theme-color-border, #898f94); \n}\n\n.modal-body { \n  flex: 1 1 auto; \n  overflow: auto; \n  padding: 1rem; \n}\n\n/* Form Styles */\n.form-grid { \n  display: grid; \n  grid-template-columns: 1fr; \n  gap: .75rem; \n}\n\n@media (min-width: 600px) { \n  .form-grid { \n    grid-template-columns: 1fr 1fr; \n  } \n}\n\n.form-group { \n  display: flex; \n  flex-direction: column; \n  gap: .25rem; \n}\n\nlabel { \n  font-size: var(--ntx-form-theme-text-label-size, 14px); \n  color: var(--ntx-form-theme-color-input-text, #161718); \n}\n\ninput, \ntextarea, \nselect { \n  display: block; \n  width: 100%; \n  max-width: 100%; \n  font-size: var(--ntx-form-theme-text-input-size, 14px); \n  border: 1px solid var(--ntx-form-theme-color-border, #898f94); \n  border-radius: var(--ntx-form-theme-border-radius, 4px); \n  padding: .45rem .6rem; \n  background: var(--ntx-form-theme-color-input-background, #fff); \n  color: var(--ntx-form-theme-color-input-text, #161718); \n}\n\ntextarea { \n  min-height: 72px; \n  resize: vertical; \n}\n\n/* Available Work Items (Touch-Friendly) */\n.avail-list { \n  display: flex; \n  flex-direction: column; \n  gap: .5rem; \n  max-height: 260px; \n  font-size: 14px; \n  overflow: auto; \n  border: 1px solid var(--ntx-form-theme-color-border, #898f94); \n  border-radius: var(--ntx-form-theme-border-radius, 4px); \n  padding: .5rem; \n  background: var(--ntx-form-theme-color-form-background, #fff); \n  width: 100%; \n  max-width: 100%; \n}\n\n.avail-row { \n  display: flex; \n  align-items: center; \n  justify-content: space-between; \n  gap: .75rem; \n  padding: .6rem .6rem; \n  border: 1px solid var(--ntx-form-theme-color-border, #898f94); \n  border-radius: var(--ntx-form-theme-border-radius, 4px); \n  min-height: 44px; \n  width: 100%; \n  box-sizing: border-box; \n}\n\n.avail-main { \n  display: flex; \n  align-items: center; \n  gap: .5rem; \n  min-width: 0; \n  flex: 1 1 auto; \n}\n\n.avail-title { \n  font-weight: 600; \n  overflow: hidden; \n  text-overflow: ellipsis; \n  white-space: nowrap; \n}\n\n.avail-price { \n  color: var(--ntx-form-theme-color-input-text-placeholder, #6c757d); \n  white-space: nowrap; \n}\n\n.avail-actions { \n  flex: 0 0 auto; \n}\n\n/* Selected Items List Styling */\n.list-table { \n  display: flex; \n  flex-direction: column; \n  gap: .5rem; \n  font-size: 14px; \n}\n\n/* CSS Custom Properties for Column Widths */\n:host { \n  --neo-col-unit: 50px; \n  --neo-col-qty: 75px; \n  --neo-col-cost: 50px; \n  --neo-col-remove: 30px; \n}\n\n.list-row { \n  padding: .5rem .75rem; \n  background: var(--ntx-form-theme-color-form-background-alternate-contrast, #0000000d); \n  border: 1px solid var(--ntx-form-theme-color-border, #898f94); \n  border-radius: var(--ntx-form-theme-border-radius, 4px); \n}\n\n.cell-name { \n  min-width: 0; \n}\n\n.cell-name .title { \n  font-weight: 600; \n  word-break: break-word; \n}\n\n.cell-unit { \n  text-align: right; \n  white-space: nowrap; \n}\n\n.cell-qty { \n  text-align: right; \n}\n\n.cell-cost { \n  white-space: nowrap; \n  text-align: right; \n}\n\n.qty-input { \n  width: var(--neo-col-qty); \n  max-width: var(--neo-col-qty); \n}\n\n.cell-label { \n  display: none; \n  margin-right: .25rem; \n  color: var(--ntx-form-theme-color-input-text-placeholder, #6c757d); \n  font-size: 12px; \n}\n\n/* Large Screens: One-Line Grid with Header */\n@media (min-width: 576px) {\n  .list-head { \n    display: grid; \n    grid-template-columns: 1fr var(--neo-col-unit) var(--neo-col-qty) var(--neo-col-cost) var(--neo-col-remove); \n    gap: .75rem; \n    align-items: center; \n    padding: .25rem .75rem; \n  }\n  \n  .list-row { \n    display: grid; \n    grid-template-columns: 1fr var(--neo-col-unit) var(--neo-col-qty) var(--neo-col-cost) var(--neo-col-remove); \n    gap: .75rem; \n    align-items: center; \n  }\n  \n  .cell-numbers { \n    display: contents; \n  }\n  \n  .cell-remove { \n    justify-self: end; \n  }\n  \n  .cell-label { \n    display: none; \n  }\n  \n  .list-head .center { \n    text-align: center; \n  }\n  \n  .qty-input { \n    width: var(--neo-col-qty); \n    max-width: var(--neo-col-qty); \n  }\n}\n\n/* Small Screens: Two-Line Layout with Inline Labels */\n@media (max-width: 575.98px) {\n  .list-head { \n    display: none; \n  }\n  \n  .list-row { \n    display: grid; \n    grid-template-columns: 1fr var(--neo-col-remove); \n    grid-template-rows: auto auto; \n    row-gap: .25rem; \n  }\n  \n  .cell-name { \n    grid-column: 1 / 2; \n    grid-row: 1; \n  }\n  \n  .cell-remove { \n    grid-column: 2 / 3; \n    grid-row: 1; \n    justify-self: end; \n    display: flex; \n  }\n  \n  .cell-numbers { \n    grid-column: 1 / -1; \n    grid-row: 2; \n    display: flex; \n    justify-content: space-evenly; \n    align-items: center; \n    gap: .75rem; \n  }\n  \n  .cell-unit, \n  .cell-qty, \n  .cell-cost { \n    width: auto; \n    text-align: center; \n  }\n  \n  .cell-qty { \n    display: flex; \n    align-items: center; \n    gap: .25rem; \n  }\n  \n  :host { \n    --neo-col-qty: 100px; \n  }\n  \n  .qty-input { \n    width: var(--neo-col-qty); \n    max-width: var(--neo-col-qty); \n  }\n  \n  .cell-label { \n    display: inline; \n  }\n  \n  .avail-title { \n    white-space: normal; \n    overflow-wrap: anywhere; \n    word-break: break-word; \n  }\n}\n",""]);const a=s},178:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},310:t=>{var e=[];function n(t){for(var n=-1,r=0;r<e.length;r++)if(e[r].identifier===t){n=r;break}return n}function r(t,r){for(var i={},s=[],a=0;a<t.length;a++){var l=t[a],d=r.base?l[0]+r.base:l[0],c=i[d]||0,h="".concat(d," ").concat(c);i[d]=c+1;var p=n(h),m={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)e[p].references++,e[p].updater(m);else{var u=o(m,r);r.byIndex=a,e.splice(a,0,{identifier:h,updater:u,references:1})}s.push(h)}return s}function o(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,o){var i=r(t=t||[],o=o||{});return function(t){t=t||[];for(var s=0;s<i.length;s++){var a=n(i[s]);e[a].references--}for(var l=r(t,o),d=0;d<i.length;d++){var c=n(i[d]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}i=l}}},406:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},413:t=>{var e={};t.exports=function(t,n){var r=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},447:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},713:t=>{t.exports=function(t){return t[1]}},791:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,o&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),e.styleTagTransform(r,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},802:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var n="",r=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),r&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),r&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n}).join("")},e.i=function(t,n,r,o,i){"string"==typeof t&&(t=[[null,t,void 0]]);var s={};if(r)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(s[l]=!0)}for(var d=0;d<t.length;d++){var c=[].concat(t[d]);r&&s[c[0]]||(void 0!==i&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=i),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),e.push(c))}},e}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={id:r,exports:{}};return t[r](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nc=void 0;const r=window,o=r.ShadowRoot&&(void 0===r.ShadyCSS||r.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,i=Symbol(),s=new WeakMap;class a{constructor(t,e,n){if(this._$cssResult$=!0,n!==i)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(o&&void 0===t){const n=void 0!==e&&1===e.length;n&&(t=s.get(e)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),n&&s.set(e,t))}return t}toString(){return this.cssText}}const l=t=>new a("string"==typeof t?t:t+"",void 0,i),d=(t,...e)=>{const n=1===t.length?t[0]:e.reduce((e,n,r)=>e+(t=>{if(!0===t._$cssResult$)return t.cssText;if("number"==typeof t)return t;throw Error("Value passed to 'css' function must be a 'css' function result: "+t+". Use 'unsafeCSS' to pass non-literal values, but take care to ensure page security.")})(n)+t[r+1],t[0]);return new a(n,t,i)},c=o?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const n of t.cssRules)e+=n.cssText;return l(e)})(t):t;var h;const p=window,m=p.trustedTypes,u=m?m.emptyScript:"",f=p.reactiveElementPolyfillSupport,v={toAttribute(t,e){switch(e){case Boolean:t=t?u:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let n=t;switch(e){case Boolean:n=null!==t;break;case Number:n=null===t?null:Number(t);break;case Object:case Array:try{n=JSON.parse(t)}catch(t){n=null}}return n}},g=(t,e)=>e!==t&&(e==e||t==t),b={attribute:!0,type:String,converter:v,reflect:!1,hasChanged:g},y="finalized";class x extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this._$Eu()}static addInitializer(t){var e;this.finalize(),(null!==(e=this.h)&&void 0!==e?e:this.h=[]).push(t)}static get observedAttributes(){this.finalize();const t=[];return this.elementProperties.forEach((e,n)=>{const r=this._$Ep(n,e);void 0!==r&&(this._$Ev.set(r,n),t.push(r))}),t}static createProperty(t,e=b){if(e.state&&(e.attribute=!1),this.finalize(),this.elementProperties.set(t,e),!e.noAccessor&&!this.prototype.hasOwnProperty(t)){const n="symbol"==typeof t?Symbol():"__"+t,r=this.getPropertyDescriptor(t,n,e);void 0!==r&&Object.defineProperty(this.prototype,t,r)}}static getPropertyDescriptor(t,e,n){return{get(){return this[e]},set(r){const o=this[t];this[e]=r,this.requestUpdate(t,o,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)||b}static finalize(){if(this.hasOwnProperty(y))return!1;this[y]=!0;const t=Object.getPrototypeOf(this);if(t.finalize(),void 0!==t.h&&(this.h=[...t.h]),this.elementProperties=new Map(t.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const t=this.properties,e=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(const n of e)this.createProperty(n,t[n])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const n=new Set(t.flat(1/0).reverse());for(const t of n)e.unshift(c(t))}else void 0!==t&&e.push(c(t));return e}static _$Ep(t,e){const n=e.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof t?t.toLowerCase():void 0}_$Eu(){var t;this._$E_=new Promise(t=>this.enableUpdating=t),this._$AL=new Map,this._$Eg(),this.requestUpdate(),null===(t=this.constructor.h)||void 0===t||t.forEach(t=>t(this))}addController(t){var e,n;(null!==(e=this._$ES)&&void 0!==e?e:this._$ES=[]).push(t),void 0!==this.renderRoot&&this.isConnected&&(null===(n=t.hostConnected)||void 0===n||n.call(t))}removeController(t){var e;null===(e=this._$ES)||void 0===e||e.splice(this._$ES.indexOf(t)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach((t,e)=>{this.hasOwnProperty(e)&&(this._$Ei.set(e,this[e]),delete this[e])})}createRenderRoot(){var t;const e=null!==(t=this.shadowRoot)&&void 0!==t?t:this.attachShadow(this.constructor.shadowRootOptions);return((t,e)=>{o?t.adoptedStyleSheets=e.map(t=>t instanceof CSSStyleSheet?t:t.styleSheet):e.forEach(e=>{const n=document.createElement("style"),o=r.litNonce;void 0!==o&&n.setAttribute("nonce",o),n.textContent=e.cssText,t.appendChild(n)})})(e,this.constructor.elementStyles),e}connectedCallback(){var t;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(t=this._$ES)||void 0===t||t.forEach(t=>{var e;return null===(e=t.hostConnected)||void 0===e?void 0:e.call(t)})}enableUpdating(t){}disconnectedCallback(){var t;null===(t=this._$ES)||void 0===t||t.forEach(t=>{var e;return null===(e=t.hostDisconnected)||void 0===e?void 0:e.call(t)})}attributeChangedCallback(t,e,n){this._$AK(t,n)}_$EO(t,e,n=b){var r;const o=this.constructor._$Ep(t,n);if(void 0!==o&&!0===n.reflect){const i=(void 0!==(null===(r=n.converter)||void 0===r?void 0:r.toAttribute)?n.converter:v).toAttribute(e,n.type);this._$El=t,null==i?this.removeAttribute(o):this.setAttribute(o,i),this._$El=null}}_$AK(t,e){var n;const r=this.constructor,o=r._$Ev.get(t);if(void 0!==o&&this._$El!==o){const t=r.getPropertyOptions(o),i="function"==typeof t.converter?{fromAttribute:t.converter}:void 0!==(null===(n=t.converter)||void 0===n?void 0:n.fromAttribute)?t.converter:v;this._$El=o,this[o]=i.fromAttribute(e,t.type),this._$El=null}}requestUpdate(t,e,n){let r=!0;void 0!==t&&(((n=n||this.constructor.getPropertyOptions(t)).hasChanged||g)(this[t],e)?(this._$AL.has(t)||this._$AL.set(t,e),!0===n.reflect&&this._$El!==t&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(t,n))):r=!1),!this.isUpdatePending&&r&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var t;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach((t,e)=>this[e]=t),this._$Ei=void 0);let e=!1;const n=this._$AL;try{e=this.shouldUpdate(n),e?(this.willUpdate(n),null===(t=this._$ES)||void 0===t||t.forEach(t=>{var e;return null===(e=t.hostUpdate)||void 0===e?void 0:e.call(t)}),this.update(n)):this._$Ek()}catch(t){throw e=!1,this._$Ek(),t}e&&this._$AE(n)}willUpdate(t){}_$AE(t){var e;null===(e=this._$ES)||void 0===e||e.forEach(t=>{var e;return null===(e=t.hostUpdated)||void 0===e?void 0:e.call(t)}),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(t){return!0}update(t){void 0!==this._$EC&&(this._$EC.forEach((t,e)=>this._$EO(e,this[e],t)),this._$EC=void 0),this._$Ek()}updated(t){}firstUpdated(t){}}var $;x[y]=!0,x.elementProperties=new Map,x.elementStyles=[],x.shadowRootOptions={mode:"open"},null==f||f({ReactiveElement:x}),(null!==(h=p.reactiveElementVersions)&&void 0!==h?h:p.reactiveElementVersions=[]).push("1.6.3");const w=window,_=w.trustedTypes,A=_?_.createPolicy("lit-html",{createHTML:t=>t}):void 0,S="$lit$",k=`lit$${(Math.random()+"").slice(9)}$`,C="?"+k,E=`<${C}>`,j=document,I=()=>j.createComment(""),M=t=>null===t||"object"!=typeof t&&"function"!=typeof t,D=Array.isArray,P="[ \t\n\f\r]",O=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,N=/-->/g,L=/>/g,T=RegExp(`>|${P}(?:([^\\s"'>=/]+)(${P}*=${P}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),U=/'/g,R=/"/g,H=/^(?:script|style|textarea|title)$/i,B=t=>(e,...n)=>({_$litType$:t,strings:e,values:n}),q=B(1),z=(B(2),Symbol.for("lit-noChange")),W=Symbol.for("lit-nothing"),F=new WeakMap,V=j.createTreeWalker(j,129,null,!1);function J(t,e){if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==A?A.createHTML(e):e}const Q=(t,e)=>{const n=t.length-1,r=[];let o,i=2===e?"<svg>":"",s=O;for(let e=0;e<n;e++){const n=t[e];let a,l,d=-1,c=0;for(;c<n.length&&(s.lastIndex=c,l=s.exec(n),null!==l);)c=s.lastIndex,s===O?"!--"===l[1]?s=N:void 0!==l[1]?s=L:void 0!==l[2]?(H.test(l[2])&&(o=RegExp("</"+l[2],"g")),s=T):void 0!==l[3]&&(s=T):s===T?">"===l[0]?(s=null!=o?o:O,d=-1):void 0===l[1]?d=-2:(d=s.lastIndex-l[2].length,a=l[1],s=void 0===l[3]?T:'"'===l[3]?R:U):s===R||s===U?s=T:s===N||s===L?s=O:(s=T,o=void 0);const h=s===T&&t[e+1].startsWith("/>")?" ":"";i+=s===O?n+E:d>=0?(r.push(a),n.slice(0,d)+S+n.slice(d)+k+h):n+k+(-2===d?(r.push(void 0),e):h)}return[J(t,i+(t[n]||"<?>")+(2===e?"</svg>":"")),r]};class K{constructor({strings:t,_$litType$:e},n){let r;this.parts=[];let o=0,i=0;const s=t.length-1,a=this.parts,[l,d]=Q(t,e);if(this.el=K.createElement(l,n),V.currentNode=this.el.content,2===e){const t=this.el.content,e=t.firstChild;e.remove(),t.append(...e.childNodes)}for(;null!==(r=V.nextNode())&&a.length<s;){if(1===r.nodeType){if(r.hasAttributes()){const t=[];for(const e of r.getAttributeNames())if(e.endsWith(S)||e.startsWith(k)){const n=d[i++];if(t.push(e),void 0!==n){const t=r.getAttribute(n.toLowerCase()+S).split(k),e=/([.?@])?(.*)/.exec(n);a.push({type:1,index:o,name:e[2],strings:t,ctor:"."===e[1]?tt:"?"===e[1]?nt:"@"===e[1]?rt:Y})}else a.push({type:6,index:o})}for(const e of t)r.removeAttribute(e)}if(H.test(r.tagName)){const t=r.textContent.split(k),e=t.length-1;if(e>0){r.textContent=_?_.emptyScript:"";for(let n=0;n<e;n++)r.append(t[n],I()),V.nextNode(),a.push({type:2,index:++o});r.append(t[e],I())}}}else if(8===r.nodeType)if(r.data===C)a.push({type:2,index:o});else{let t=-1;for(;-1!==(t=r.data.indexOf(k,t+1));)a.push({type:7,index:o}),t+=k.length-1}o++}}static createElement(t,e){const n=j.createElement("template");return n.innerHTML=t,n}}function G(t,e,n=t,r){var o,i,s,a;if(e===z)return e;let l=void 0!==r?null===(o=n._$Co)||void 0===o?void 0:o[r]:n._$Cl;const d=M(e)?void 0:e._$litDirective$;return(null==l?void 0:l.constructor)!==d&&(null===(i=null==l?void 0:l._$AO)||void 0===i||i.call(l,!1),void 0===d?l=void 0:(l=new d(t),l._$AT(t,n,r)),void 0!==r?(null!==(s=(a=n)._$Co)&&void 0!==s?s:a._$Co=[])[r]=l:n._$Cl=l),void 0!==l&&(e=G(t,l._$AS(t,e.values),l,r)),e}class Z{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){var e;const{el:{content:n},parts:r}=this._$AD,o=(null!==(e=null==t?void 0:t.creationScope)&&void 0!==e?e:j).importNode(n,!0);V.currentNode=o;let i=V.nextNode(),s=0,a=0,l=r[0];for(;void 0!==l;){if(s===l.index){let e;2===l.type?e=new X(i,i.nextSibling,this,t):1===l.type?e=new l.ctor(i,l.name,l.strings,this,t):6===l.type&&(e=new ot(i,this,t)),this._$AV.push(e),l=r[++a]}s!==(null==l?void 0:l.index)&&(i=V.nextNode(),s++)}return V.currentNode=j,o}v(t){let e=0;for(const n of this._$AV)void 0!==n&&(void 0!==n.strings?(n._$AI(t,n,e),e+=n.strings.length-2):n._$AI(t[e])),e++}}class X{constructor(t,e,n,r){var o;this.type=2,this._$AH=W,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=n,this.options=r,this._$Cp=null===(o=null==r?void 0:r.isConnected)||void 0===o||o}get _$AU(){var t,e;return null!==(e=null===(t=this._$AM)||void 0===t?void 0:t._$AU)&&void 0!==e?e:this._$Cp}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===(null==t?void 0:t.nodeType)&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=G(this,t,e),M(t)?t===W||null==t||""===t?(this._$AH!==W&&this._$AR(),this._$AH=W):t!==this._$AH&&t!==z&&this._(t):void 0!==t._$litType$?this.g(t):void 0!==t.nodeType?this.$(t):(t=>D(t)||"function"==typeof(null==t?void 0:t[Symbol.iterator]))(t)?this.T(t):this._(t)}k(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}$(t){this._$AH!==t&&(this._$AR(),this._$AH=this.k(t))}_(t){this._$AH!==W&&M(this._$AH)?this._$AA.nextSibling.data=t:this.$(j.createTextNode(t)),this._$AH=t}g(t){var e;const{values:n,_$litType$:r}=t,o="number"==typeof r?this._$AC(t):(void 0===r.el&&(r.el=K.createElement(J(r.h,r.h[0]),this.options)),r);if((null===(e=this._$AH)||void 0===e?void 0:e._$AD)===o)this._$AH.v(n);else{const t=new Z(o,this),e=t.u(this.options);t.v(n),this.$(e),this._$AH=t}}_$AC(t){let e=F.get(t.strings);return void 0===e&&F.set(t.strings,e=new K(t)),e}T(t){D(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let n,r=0;for(const o of t)r===e.length?e.push(n=new X(this.k(I()),this.k(I()),this,this.options)):n=e[r],n._$AI(o),r++;r<e.length&&(this._$AR(n&&n._$AB.nextSibling,r),e.length=r)}_$AR(t=this._$AA.nextSibling,e){var n;for(null===(n=this._$AP)||void 0===n||n.call(this,!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){var e;void 0===this._$AM&&(this._$Cp=t,null===(e=this._$AP)||void 0===e||e.call(this,t))}}class Y{constructor(t,e,n,r,o){this.type=1,this._$AH=W,this._$AN=void 0,this.element=t,this.name=e,this._$AM=r,this.options=o,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=W}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,e=this,n,r){const o=this.strings;let i=!1;if(void 0===o)t=G(this,t,e,0),i=!M(t)||t!==this._$AH&&t!==z,i&&(this._$AH=t);else{const r=t;let s,a;for(t=o[0],s=0;s<o.length-1;s++)a=G(this,r[n+s],e,s),a===z&&(a=this._$AH[s]),i||(i=!M(a)||a!==this._$AH[s]),a===W?t=W:t!==W&&(t+=(null!=a?a:"")+o[s+1]),this._$AH[s]=a}i&&!r&&this.j(t)}j(t){t===W?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=t?t:"")}}class tt extends Y{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===W?void 0:t}}const et=_?_.emptyScript:"";class nt extends Y{constructor(){super(...arguments),this.type=4}j(t){t&&t!==W?this.element.setAttribute(this.name,et):this.element.removeAttribute(this.name)}}class rt extends Y{constructor(t,e,n,r,o){super(t,e,n,r,o),this.type=5}_$AI(t,e=this){var n;if((t=null!==(n=G(this,t,e,0))&&void 0!==n?n:W)===z)return;const r=this._$AH,o=t===W&&r!==W||t.capture!==r.capture||t.once!==r.once||t.passive!==r.passive,i=t!==W&&(r===W||o);o&&this.element.removeEventListener(this.name,this,r),i&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var e,n;"function"==typeof this._$AH?this._$AH.call(null!==(n=null===(e=this.options)||void 0===e?void 0:e.host)&&void 0!==n?n:this.element,t):this._$AH.handleEvent(t)}}class ot{constructor(t,e,n){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(t){G(this,t)}}const it=w.litHtmlPolyfillSupport;var st,at;null==it||it(K,X),(null!==($=w.litHtmlVersions)&&void 0!==$?$:w.litHtmlVersions=[]).push("2.8.0");class lt extends x{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var t,e;const n=super.createRenderRoot();return null!==(t=(e=this.renderOptions).renderBefore)&&void 0!==t||(e.renderBefore=n.firstChild),n}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=((t,e,n)=>{var r,o;const i=null!==(r=null==n?void 0:n.renderBefore)&&void 0!==r?r:e;let s=i._$litPart$;if(void 0===s){const t=null!==(o=null==n?void 0:n.renderBefore)&&void 0!==o?o:null;i._$litPart$=s=new X(e.insertBefore(I(),t),t,void 0,null!=n?n:{})}return s._$AI(t),s})(e,this.renderRoot,this.renderOptions)}connectedCallback(){var t;super.connectedCallback(),null===(t=this._$Do)||void 0===t||t.setConnected(!0)}disconnectedCallback(){var t;super.disconnectedCallback(),null===(t=this._$Do)||void 0===t||t.setConnected(!1)}render(){return z}}lt.finalized=!0,lt._$litElement$=!0,null===(st=globalThis.litElementHydrateSupport)||void 0===st||st.call(globalThis,{LitElement:lt});const dt=globalThis.litElementPolyfillSupport;null==dt||dt({LitElement:lt}),(null!==(at=globalThis.litElementVersions)&&void 0!==at?at:globalThis.litElementVersions=[]).push("3.3.3");var ct=n(310),ht=n.n(ct),pt=n(791),mt=n.n(pt),ut=n(413),ft=n.n(ut),vt=n(406),gt=n.n(vt),bt=n(178),yt=n.n(bt),xt=n(447),$t=n.n(xt),wt=n(2),_t={};_t.styleTagTransform=$t(),_t.setAttributes=gt(),_t.insert=ft().bind(null,"head"),_t.domAPI=mt(),_t.insertStyleElement=yt(),ht()(wt.A,_t);const At=wt.A&&wt.A.locals?wt.A.locals:void 0,St=()=>Math.random().toString(36).slice(2,10);customElements.define("neo-pricework",class extends lt{static getMetaConfig(){return{controlName:"neo-pricework",fallbackDisableSubmit:!1,description:"Create, list and edit job line items with totals",iconUrl:"",groupName:"NEO",version:"1.0",properties:{apiKey:{type:"string",title:"Google Maps API key",description:"API key used for address autocomplete"},inputobj:{type:"object",title:"Input object",description:"Preload jobs array and meta",properties:{jobs:{type:"array",items:{type:"object",properties:{id:{type:"string"},address:{type:"string",title:"Address"},contract:{type:"string",title:"Contract"},notes:{type:"string",title:"Job Notes"},items:{type:"array",items:{type:"object",properties:{itemCode:{type:"string"},name:{type:"string"},price:{type:"number"},quantity:{type:"number"}}}}}}}}},contracts:{type:"string",title:"Contracts (comma-separated)",description:"Provide the list of available contracts separated by commas",defaultValue:""},workItems:{type:"object",title:"Work Items Catalog",description:"Provide work items to choose from grouped by contract",properties:{items:{type:"array",items:{type:"object",properties:{name:{type:"string",title:"Display Name"},contract:{type:"string",title:"Contract key"},itemCode:{type:"string",title:"Item code"},price:{type:"number",title:"Unit price"}}}}}},currency:{type:"string",title:"Currency symbol",description:"Displayed before amounts",defaultValue:"£"},readOnly:{type:"boolean",title:"Read only",description:"Whether this control should be read-only",defaultValue:!1},outputobj:{type:"object",title:"Output object",description:"Form-bound output",isValueField:!0}},standardProperties:{fieldLabel:!0,description:!0}}}static get properties(){return{apiKey:{type:String},inputobj:{type:Object},outputobj:{type:Object},contracts:{type:String},workItems:{type:Object},currency:{type:String},readOnly:{type:Boolean},jobs:{type:Array,state:!0},showModal:{type:Boolean,state:!0},editingIndex:{type:Number,state:!0},formData:{type:Object,state:!0},workItemQuery:{type:String,state:!0},noteOpen:{type:Object,state:!0}}}static get styles(){return d`${l(At)}`}constructor(){super(),this.apiKey="",this.inputobj=null,this.outputobj={jobs:[],subtotal:0,count:0},this.contracts="",this.workItems={items:[]},this.currency="£",this.readOnly=!1,this.jobs=[],this.showModal=!1,this.editingIndex=-1,this.formData=this.getEmptyForm(),this.workItemQuery="",this._gmapsLoaded=!1,this._autocomplete=null,this._placesService=null,this._addressIsUserInput=!1,this._addressPreviousValue="",this._addressLastResolved="",this.noteOpen=new Set}getEmptyForm(){return{id:"",address:"",contract:"",items:[],notes:""}}updated(t){if(t.has("inputobj")&&this.inputobj){const t=Array.isArray(this.inputobj.jobs)?this.inputobj.jobs:[];this.jobs=t.map(t=>({...t,id:t.id||St()})),this.recomputeAndDispatch()}}itemTotal(t){return Number(t.price||0)*Number(t.quantity||0)}jobTotal(t){return(t.items||[]).reduce((t,e)=>t+this.itemTotal(e),0)}subtotal(){return this.jobs.reduce((t,e)=>t+this.jobTotal(e),0)}recomputeAndDispatch(){this.outputobj={jobs:this.jobs,subtotal:this.subtotal(),count:this.jobs.length},this.dispatchEvent(new CustomEvent("ntx-value-change",{detail:this.outputobj,bubbles:!0,composed:!0}))}openAdd=()=>{this.readOnly||(this.formData={...this.getEmptyForm(),id:St()},this.editingIndex=-1,this.showModal=!0,this.updateComplete.then(()=>this.ensureGoogleMapsLoadedAndInit()))};openEdit=t=>{if(this.readOnly)return;const e=this.jobs[t];e&&(this.formData={...e},this.editingIndex=t,this.showModal=!0,this.updateComplete.then(()=>this.ensureGoogleMapsLoadedAndInit()))};closeModal=()=>{this.showModal=!1};onInput=(t,e)=>{const n=t.target?.value;this.formData={...this.formData,[e]:n}};onContractChange=t=>{const e=t.target.value;this.formData={...this.formData,contract:e}};getContractOptions(){const t=this.contracts;let e=[];if(!t)return e;if(Array.isArray(t))e=t;else if("string"==typeof t){const n=t.trim();if(n.startsWith("[")&&n.endsWith("]")||n.startsWith("{")&&n.endsWith("}"))try{const t=JSON.parse(n);e=Array.isArray(t)?t:t&&"object"==typeof t?[t]:[]}catch{e=n.split(",")}else e=n.split(",")}else"object"==typeof t&&t&&(e=[t]);const n=e.map(t=>"string"==typeof t?t.trim():t&&"object"==typeof t?String(t.contract??t.name??t.value??"").trim():"").filter(Boolean),r=new Set;return n.filter(t=>!r.has(t)&&(r.add(t),!0))}getAvailableWorkItems(){const t=new Set((this.formData.items||[]).map(t=>t.name));let e=(Array.isArray(this.workItems?.items)?this.workItems.items:[]).filter(e=>!(this.formData.contract&&e.contract!==this.formData.contract||t.has(e.name)));const n=(this.workItemQuery||"").trim().toLowerCase();if(!n)return e;const r=n.split(/\s+/).filter(Boolean),o=[],i=[];for(const t of e){const e=(t.itemCode||"").toLowerCase();e&&e.includes(n)?o.push(t):i.push(t)}if(o.length>0)return o;const s=i.filter(t=>{const e=(t.name||"").toLowerCase();return r.every(t=>{if(e.includes(t))return!0;let n=0;for(const r of t){if(n=e.indexOf(r,n),-1===n)return!1;n++}return!0})});return s}addSelectedWorkItems=t=>{const e=t.target,n=Array.from(e.selectedOptions||[]);if(0===n.length)return;const r=this.getAvailableWorkItems(),o=new Set(n.map(t=>t.value)),i=r.filter(t=>o.has(t.name)).map(t=>({itemCode:t.itemCode||"",name:t.name,price:Number(t.price)||0,quantity:1})),s=[...this.formData.items||[],...i];this.formData={...this.formData,items:s},e.selectedIndex=-1};addWorkItem=t=>{if(!t)return;const e=(this.formData.items||[]).some(e=>e.name===t.name);if(e)return;const n=[...this.formData.items||[],{itemCode:t.itemCode||"",name:t.name,price:Number(t.price)||0,quantity:1,contract:t.contract||this.formData.contract||""}];this.formData={...this.formData,items:n}};getJobContracts(t){const e=new Set,n=t.contract;return Array.isArray(n)?n.forEach(t=>{t&&e.add(String(t).trim())}):"string"==typeof n&&n.split(",").map(t=>t.trim()).filter(Boolean).forEach(t=>e.add(t)),(t.items||[]).forEach(t=>{t&&t.contract&&e.add(String(t.contract).trim())}),Array.from(e).filter(Boolean)}toggleNotes=t=>{const e=new Set(this.noteOpen||[]);e.has(t)?e.delete(t):e.add(t),this.noteOpen=e};updateItemQty=(t,e)=>{const n=Math.max(0,Number(e.target.value||0)),r=[...this.formData.items||[]];r[t]&&(r[t]={...r[t],quantity:n},this.formData={...this.formData,items:r})};removeSelectedItem=t=>{const e=(this.formData.items||[]).filter((e,n)=>n!==t);this.formData={...this.formData,items:e}};save=()=>{const t={...this.formData};if(Array.isArray(t.items)&&0!==t.items.length){if(-1===this.editingIndex)this.jobs=[...this.jobs,t];else{const e=[...this.jobs];e[this.editingIndex]=t,this.jobs=e}this.showModal=!1,this.recomputeAndDispatch()}};remove=t=>{const e=this.jobs.filter((e,n)=>n!==t);this.jobs=e,this.showModal=!1,this.recomputeAndDispatch()};renderRow(t,e){const n=this.getJobContracts(t),r=!(!t.notes||!String(t.notes).trim()),o=this.noteOpen?.has(t.id);return q`
      <div class="card">
        <div class="card-body">
          <div class="row" style="display: grid; grid-template-columns: 1fr auto; gap: .5rem .75rem; align-items: start;">
            <!-- Row 1: Address (left) -->
            <div class="field-line">
              <span class="inline-label">Address:</span>
              <span class="title">${t.address||"Untitled job"}</span>
            </div>
            <div></div>

            <!-- Row 2: Contracts (left) + Summary (right) -->
            <div class="field-line" style="margin-top:.25rem;">
              <span class="inline-label">Contracts:</span>
              ${n.length?q`
                <span class="pill-group">
                  ${n.map(t=>q`<span class="pill">${t}</span>`)}
                </span>
              `:q`<span class="muted">None</span>`}
            </div>
            <div class="right">
              <div class="summary">${t.items?.length||0} work item${1===(t.items?.length||0)?"":"s"} - ${this.currency}${this.jobTotal(t).toFixed(2)}</div>
            </div>

            <!-- Row 3: Actions (right) -->
            <div></div>
            <div class="right-actions">
              ${this.readOnly?"":q`
                <button class="btn btn-light btn-compact" title="Edit" aria-label="Edit" @click=${()=>this.openEdit(e)}>
                  <span>Edit</span>
                  <!-- refined pencil icon -->
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 21l1.5-.5L18.5 6.5a2.12 2.12 0 10-3-3L1.5 17.5 3 21z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M14.5 4.5l3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </button>
              `}
              ${r?q`
                <button class="btn btn-light btn-compact" title="${o?"Hide":"Show"} notes" aria-label="${o?"Hide":"Show"} notes" @click=${()=>this.toggleNotes(t.id)}>
                  <span>Notes</span>
                  ${o?q`
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 15l6-6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  `:q`
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 9l6 6 6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                  `}
                </button>
              `:""}
            </div>
          </div>
          ${o&&r?q`<div class="notes">${t.notes}</div>`:""}
        </div>
      </div>
    `}renderModal(){if(!this.showModal)return null;const t=this.editingIndex>-1;return q`
      <div class="backdrop" @click=${t=>{t.target===t.currentTarget&&this.closeModal()}}>
        <div class="modal" role="dialog" aria-modal="true">
          <div class="modal-header">
            <div class="card-title">${t?"Edit Job":"Add Job"}</div>
            <button class="btn btn-light" @click=${this.closeModal}>Close</button>
          </div>
          <div class="modal-body">
            <div class="form-grid">
              <div class="form-group" style="grid-column: 1 / -1;">
                <label>Address</label>
                <input id="addressInput" type="text" .value=${this.formData.address}
                  @input=${this.onAddressTyping}
                  @blur=${this.onAddressBlur}
                  @change=${this.onAddressBlur}
                  placeholder="Search for an address" />
              </div>
              <div class="form-group" style="grid-column: 1 / -1;">
                <label>Contract</label>
                <select .value=${this.formData.contract} @change=${this.onContractChange}>
                  <option value="">Select contract</option>
                  ${this.getContractOptions().map(t=>q`<option value="${t}">${t}</option>`)}
                </select>
              </div>
              <div class="form-group" style="grid-column: 1 / -1;">
                <label>Work Items</label>
                <input type="text" placeholder="Search work items" .value=${this.workItemQuery}
                  @input=${t=>{this.workItemQuery=t.target.value}} />
                <div class="avail-list" role="list">
                  ${this.getAvailableWorkItems().map(t=>q`
                    <div class="avail-row" role="listitem">
                      <div class="avail-main">
                        <div class="avail-title">${t.name}</div>
                        <div class="avail-price">${this.currency}${Number(t.price).toFixed(2)}</div>
                      </div>
                      <div class="avail-actions">
                        <button class="icon-btn success" @click=${()=>this.addWorkItem(t)} aria-label=${`Add ${t.name}`} title="Add">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
                          </svg>
                        </button>
                      </div>
                    </div>
                  `)}
                </div>
              </div>
              <div class="form-group" style="grid-column: 1 / -1;">
                ${Array.isArray(this.formData.items)&&this.formData.items.length>0?q`
                  <div class="list-table">
                    <div class="list-head sm">
                      <div>Selected Work Item</div>
                      <div class="center">Price</div>
                      <div class="center">Qty</div>
                      <div class="center">Cost</div>
                      <div></div>
                    </div>
                    ${this.formData.items.map((t,e)=>q`
                      <div class="list-row">
                        <div class="cell-name">
                          <div class="title">${t.name}</div>
                        </div>
                        <div class="cell-numbers">
                          <div class="cell-unit"><span class="cell-label">Price </span><span class="sm">${this.currency}${Number(t.price).toFixed(2)}</span></div>
                          <div class="cell-qty"><span class="cell-label">Qty </span><input class="qty-input" type="number" min="0" step="1" .value=${String(t.quantity??0)} @input=${t=>this.updateItemQty(e,t)} /></div>
                          <div class="cell-cost"><span class="cell-label">Cost </span><span class="total">${this.currency}${this.itemTotal(t).toFixed(2)}</span></div>
                        </div>
                        <div class="cell-remove">
                          <button class="icon-btn" title="Remove" aria-label="Remove" @click=${()=>this.removeSelectedItem(e)}>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path d="M3 6h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                              <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" stroke="currentColor" stroke-width="2"/>
                              <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6" stroke="currentColor" stroke-width="2"/>
                              <path d="M10 11v6M14 11v6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                          </button>
                        </div>
                      </div>
                    `)}
                  </div>
                `:q`<div class="muted">No items selected yet.</div>`}
              </div>
              <div class="form-group" style="grid-column: 1 / -1;">
                <label>Job Notes</label>
                <textarea .value=${this.formData.notes} @input=${t=>this.onInput(t,"notes")} placeholder="Add any notes about this job"></textarea>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <div class="muted">Job total: <strong>${this.currency}${this.jobTotal(this.formData).toFixed(2)}</strong></div>
            <div class="actions">
              ${t?q`<button class="btn btn-danger" @click=${()=>this.remove(this.editingIndex)}>Delete</button>`:""}
              <button class="btn btn-outline" @click=${this.closeModal}>Cancel</button>
              <button class="btn btn-primary" @click=${this.save} ?disabled=${!(this.formData.items?.length>0)}>Save</button>
            </div>
          </div>
        </div>
      </div>
    `}ensureGoogleMapsLoadedAndInit(){const t=this.shadowRoot?.getElementById("addressInput");if(!t)return;if(this._gmapsLoaded&&window.google&&window.google.maps)return void this.initAutocomplete(t);if(!this.apiKey)return;if(window.google&&window.google.maps)return this._gmapsLoaded=!0,void this.initAutocomplete(t);const e=document.querySelector("script[data-neo-pricework-gmaps]");if(e)return void e.addEventListener("load",()=>{this._gmapsLoaded=!0,this.initAutocomplete(t)},{once:!0});const n=document.createElement("script");n.src=`https://maps.googleapis.com/maps/api/js?key=${this.apiKey}&libraries=places`,n.async=!0,n.defer=!0,n.dataset.neoPriceworkGmaps="1",n.addEventListener("load",()=>{this._gmapsLoaded=!0,this.initAutocomplete(t)},{once:!0}),n.addEventListener("error",()=>{console.error("Failed to load Google Maps API")},{once:!0}),document.head.appendChild(n)}initAutocomplete(t){window.google&&window.google.maps&&t&&(this._autocomplete=new google.maps.places.Autocomplete(t,{types:["address"]}),this._autocomplete.addListener("place_changed",()=>{const t=this._autocomplete.getPlace();t&&t.formatted_address&&(this._addressIsUserInput=!0,this.formData={...this.formData,address:t.formatted_address},this._addressPreviousValue=this.formData.address,this._addressLastResolved=this.formData.address)}),this._placesService=new google.maps.places.PlacesService(document.createElement("div")))}onAddressTyping=t=>{this._addressIsUserInput=!0;const e=t.target.value;this.formData={...this.formData,address:e},this._addressPreviousValue=e};onAddressBlur=()=>{const t=this.formData.address||"";if(!t.trim())return;if(!(this._gmapsLoaded&&this._placesService&&window.google&&window.google.maps))return;if(t===this._addressLastResolved)return;const e={query:t,fields:["formatted_address","geometry","name"]};this._placesService.findPlaceFromQuery(e,(e,n)=>{if(n===google.maps.places.PlacesServiceStatus.OK&&e&&e.length>0){const t=e[0];t.formatted_address&&t.formatted_address!==this.formData.address&&(this.formData={...this.formData,address:t.formatted_address}),this._addressLastResolved=this.formData.address}else this._addressLastResolved=t})};render(){const t=this.subtotal();return q`
      <div class="list-header">
        <div class="card-title">Jobs</div>
        <span class="badge">${this.jobs.length} item${1===this.jobs.length?"":"s"}</span>
      </div>

      <div class="rows">
        ${0===this.jobs.length?q`<div class="empty">No jobs yet. Use the button below to add your first job.</div>`:this.jobs.map((t,e)=>this.renderRow(t,e))}
      </div>

      <div class="footer">
        <div class="muted">Subtotal</div>
        <div class="total">${this.currency}${t.toFixed(2)}</div>
      </div>

      ${this.readOnly?"":q`
        <div style="margin-top:.5rem; display:flex; justify-content:flex-end;">
          <button class="btn btn-primary" @click=${this.openAdd}>Add Job</button>
        </div>
      `}

      ${this.renderModal()}
    `}})})();